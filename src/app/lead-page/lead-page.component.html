<div class="chatbox-container" [class.hidden]="!sessionId">
  <div class="chatbox-header">
    <button class="close-btn" [disabled]="loading" (click)="goBack()">Ã—</button>  <!-- Use goBack() to navigate back -->
    <div class="session-info" *ngIf="sessionId">{{ sessionId }}</div>  <!-- Show session ID -->
  </div>
  <div class="chatbox-header-2">
    <div class="session-info" *ngIf="brn">{{ brn }}</div>  <!-- Show session ID -->
  </div>

  <div class="chatbox-body" id="chatboxBody">
    <div *ngFor="let message of messages">
      <div class="message" *ngIf="message.sender === 'user'" [ngClass]="message.sender === 'user' ? 'sent' : 'received'">
        {{ message.text }}
      </div>
      <div class="bot-message" *ngIf="message.sender === 'bot'">
        <markdown [data]="message.text"></markdown>  <!-- Render markdown content -->
      </div>
    </div>

    <!-- Loader -->
    <div *ngIf="loading" class="loader">
      <img src="assets/images/Ellipsis@1x-1.0s-200px-200px.svg" alt="Loading..." />
    </div>
  </div>

  <!-- Disable bubble buttons while loading -->
  <div class="chatbox-bubble-section">
    <button class="chat-topic-button" (click)="sendBubbleQuery('redflags')" [disabled]="loading">Red Flags</button>
    <button class="chat-topic-button" (click)="sendBubbleQuery('insights')" [disabled]="loading">Insights</button>
    <button class="chat-topic-button" (click)="sendBubbleQuery('product_recommendation')" [disabled]="loading">Product Recommendation</button>
  </div>

  <div class="chatbox-footer">
    <input [(ngModel)]="query" type="text" placeholder="Ask me anything..." [disabled]="loading" (keyup.enter)="sendMessage()" />
    <img 
      src="assets/images/send-icon.png" 
      alt="Send" 
      (click)="sendMessage()" 
      [class.disabled]="loading" 
      class="send-icon" />
  </div>
</div>

<!-- Hidden chatbox trigger button -->
<img class="chatbox-image" src="assets/images/Chatbox_Close.png" (click)="onChatboxImageClick()" />
